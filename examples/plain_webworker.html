<html>
<head>

<!-- <script type="text/javascript" src="../bin/xio.js"></script> -->
  <script type="text/javascript" src="../../X/lib/google-closure-library/closure/goog/base.js"></script>
  <script type="text/javascript" src="../../X/xtk-deps.js"></script>
  

<script type="text/javascript">

goog.require('X.renderer3D');
goog.require('X.slice');


var _header = null;
var _slices = null;

  function load_data() {

    worker1 = new Worker('webworker.js');
    
    
    worker1.onmessage = function(e) {
      
      if (e.data.cmd) {
	      
	      var _cmd = e.data.cmd;
	      var _what = e.data.what;
	      var _value = e.data.value;
	
	      if (_cmd == 'done') {
	        
	        if (_what == 'header') {        
	          _header = _value;
	             

	          rend();
	          get_slice(Math.floor(_header.dim[3]/2));

	          
	        }
	        
	      }
	      
      } else {
        
        _slices  = e.data;
        slice.texture._rawData = new Uint8Array(_slices);
        slice.texture._rawDataWidth = _header.dim[1];
        slice.texture._rawDataHeight = _header.dim[2];        
        slice.texture._dirty = true;
        slice.modified();    
        
      }

    };

    worker1.postMessage({cmd:'load', what:'http://x.babymri.org/?23/template.nii', value:null});    
    
  };
  
  function get_slice(i) {
    
    worker1.postMessage({cmd:'get', what:'http://x.babymri.org/?23/template.nii', value:i});
    
  }
  
  
  function rend() {
    
    
    ren2d = new X.renderer2D();
    ren2d.orientation = 'Z';
    ren2d.init();
    
    vol = new X.volume();
    
    slice = new X.slice();
    slice._width = _header.dim[1];
    slice._height =  _header.dim[2];
    slice.create_();
/*     slice.texture._rawData = new Uint8Array(_slices);
    slice.texture._rawDataWidth = _header.dim[1];
    slice.texture._rawDataHeight = _header.dim[2]; */
    
    
    ren2d.add(vol);
    
    ren2d.render();
    
  }
  
  window.onload = function() {

    load_data();
  }
  
</script>

</head>

<body>
</body>
</html>