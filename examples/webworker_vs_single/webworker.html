<html>
<head>
<script type="text/javascript" src='http://get.goxtk.com/xtk.js'></script>
<script type="text/javascript">
  function load_data() {
    console.log('WEBWORKERS');
    
    console.time('twelve_other_volumes');
    
    var workercount = 12;
    
    // worker arrays
    var workers = new Array(workercount);
    var workerstatus = new Array(workercount);
    
    
    for (var i=0; i<workercount;i++) {
      
      var currentworker = new Worker('webworker.js');
      
      currentworker.onmessage = onworkermessage.bind(this,i);
    
      workerstatus[i] = false;
      
      workers[i] = currentworker;
      
    }
    
    
    function onworkermessage(worker_id, e) {
      
      //console.log('worker'+worker_id, e);
      
      workerstatus[worker_id] = true;
      
      check_workers();
      
    }
    
    
    
    function check_workers() {
      
      if (workerstatus.every(function(v) { return v; })) {
        
        console.timeEnd('twelve_other_volumes');
        
      }
      
    }
    
    // start the workers
    for (var i=0; i<workercount;i++) {
      
      workers[i].postMessage('http://x.babymri.org/?'+(i+24)+'/template.nii')
      
    }
    
        
    
  };
  

  window.onload = function() {
    
    // start the webworkers
    load_data();
    
    // and load a single volume
    console.time('first_volume');
    var r = new X.renderer3D();
    r.init();
    
    var f = new X.volume();
    f.file = 'http://x.babymri.org/?23/template.nii';
    
    r.add(f);
    r.render();
        
    r.onShowtime = function() {
      console.timeEnd('first_volume');
    }
    
    
  }
  
</script>

</head>
<body id='body'>

</body>
</html>